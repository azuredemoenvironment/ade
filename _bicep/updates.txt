# global

- removed \*.parameters.json files from repo (local only)
- moved \*.json templates to \_archive folder

## scripts

### Set-InitialArmParameters.ps1

created insert text here...

added
'applicationInsightsName'                           = "appinsights-ade-$aliasRegion-001"

modified 
$primaryRegionResourceGroupNamePrefix               = "rg-ade-$aliasRegion"
$secondaryRegionResourceGroupNamePrefix             = "rg-ade-$aliasSecondaryRegion"

'activityLogDiagnosticsName'                        = 'subscriptionactivitylog'
'applicationGatewayManagedIdentityName'             = "id-ade-$aliasRegion-agw"
'containerRegistryManagedIdentityName'              = "id-ade-$aliasRegion-acr"
'containerRegistrySPNName'                          = "spn-ade-$aliasRegion-acr"
'githubActionsSPNName'                              = "spn-ade-$aliasRegion-gha"
'keyVaultName'                                      = "kv-ade-$aliasRegion-001"
'natGatewayName'                                    = "natgw-$aliasRegion-001"
'natGatewayPublicIPPrefixName'                      = "pipp-$aliasRegion-001"
'restAPISPNName'                                    = "spn-ade-$aliasRegion-restapi"

'managedIdentityResourceGroupName'                  = "$primaryRegionResourceGroupNamePrefix-identity"
'monitorResourceGroupName'                          = "$primaryRegionResourceGroupNamePrefix-monitor"
'primaryRegionAppServicePlanResourceGroupName'      = "$primaryRegionResourceGroupNamePrefix-appserviceplan"
'secondaryRegionAppServicePlanResourceGroupName'    = "$secondaryRegionResourceGroupNamePrefix-appserviceplan"

removed 
'automationAccountName'                             = "aa-ade-$aliasRegion-001"
'azureBastionName'                                  = "bastion-ade-$aliasRegion-001"
'azureBast

'connectionName'                                    = "cn-$aliasRegion-01"
'developerSubnetNSGName'                            = "nsg-ade-$aliasRegion-developer"
'developerName'                                     = "vm-developer01"
'developerNICName'                                  = "nic-$aliasRegion-developer01"
'developerOSDiskName'                               = "disk-$aliasRegion-developer01-os"
'developerPublicIPAddressName'                      = "pip-$aliasRegion-developer01" 
'directoryServicesSubnetNSGName'                    = "nsg-ade-$aliasRegion-directoryservices"
'firewallName'                                      = "fw-$aliasRegion-01"
'firewallPublicIPAddressName'                       = "pip-$aliasRegion-fw01"
'imageResizerAppInsightsName'                       = "appin-$aliasRegion-imageresizer"
'imageResizerFQDN'                                  = "as-$aliasRegion-imgreszr.azurewebsites.net".Replace('-', '')
'imageResizerFunctionAppName'                       = "fa-$aliasRegion-imgreszr".replace('-', '')
'imageResizerFunctionAppStorageAccountName'         = "sa-$aliasRegion-faimgreszr".Replace('-', '')
'imageResizerHostName'                              = "imageresizer.$rootDomainName".replace('-', '')
'imageResizerpBackupStorageAccountName'             = "sa-$aliasRegion-bkpimgreszr".Replace('-', '')
'imageResizerWebAppName'                            = "as-$aliasRegion-imgreszr".Replace('-', '')
'imageResizerWebAppStorageAccountName'              = "sa-$aliasRegion-asimgreszr".Replace('-', '')  
"inspectorGadgetAppInsightsName"                    = "appin-$aliasRegion-inspectorgadget"
'internetRouteTableName'                            = "route-ade-$aliasRegion-internet"
'jumpboxName'                                       = "vm-jumpbox01"
'jumpboxNICName'                                    = "nic-$aliasRegion-jumpbox01"
'jumpboxOSDiskName'                                 = "disk-$aliasRegion-jumpbox01-os"
'jumpboxPublicIPAddressName'                        = "pip-$aliasRegion-jumpbox01"
'localNetworkGatewayName'                           = "lng-$aliasRegion-01"
'natGatewayName'                                    = "ngw-ade-$aliasRegion-001"
'natGatewayPublicIPPrefixName'                      = "pipp-ade-$aliasRegion-ngw001"
'natGatewayPublicIPAddressName'                     = "pip-ade-$aliasRegion-natgw01"
'nTierDB01NICName'                                  = "nic-$aliasRegion-ntierdb01"
'nTierDB01OSDiskName'                               = "disk-$aliasRegion-ntierdb01-os"
'nTierDB02NICName'                                  = "nic-$aliasRegion-ntierdb02"
'nTierDB02OSDiskName'                               = "disk-$aliasRegion-ntierdb02-os"
'nTierDBAvailabilitySetName'                        = "avset-$aliasRegion-ntierdb"
'nTierDBLoadBalancerName'                           = "lb-$aliasRegion-ntierdb"
'nTierWeb01NICName'                                 = "nic-$aliasRegion-ntierweb01"
'nTierWeb01OSDiskName'                              = "disk-$aliasRegion-ntierweb01-os"
'nTierWeb02NICName'                                 = "nic-$aliasRegion-ntierweb02"
'nTierWeb02OSDiskName'                              = "disk-$aliasRegion-ntierweb02-os"
'nTierWebAvailabilitySetName'                       = "avset-$aliasRegion-ntierweb"  
'peering01'                                         = "vnet-$aliasRegion-01-to-vnet-$aliasRegion-02"
'peering02'                                         = "vnet-$aliasRegion-02-to-vnet-$aliasRegion-01"
'peering03'                                         = "vnet-$aliasRegion-01-to-vnet-$aliasRegion-03"
'peering04'                                         = "vnet-$aliasRegion-03-to-vnet-$aliasRegion-01" 
'primaryRegionHelloWorldAppInsightsName'            = "appin-$aliasRegion-helloworld"
'primaryRegionHelloWorldEndpointName'               = "helloworld-$defaultPrimaryRegionShortName".replace('-', '')
'primaryRegionHelloWorldWebAppName'                 = "as-$aliasRegion-helloworld".replace('-', '')
'primaryRegionHelloWorldWebAppStorageAccountName'   = "sa-$aliasRegion-bkphello".replace('-', '')
'secondaryRegionAppServicePlanName'                 = "plan-ade-$aliasSecondaryRegion-001"
'secondaryRegionHelloWorldAppInsightsName'          = "appin-$aliasSecondaryRegion-helloworld"
'secondaryRegionHelloWorldEndpointName'             = "helloworld-$defaultSecondaryRegionShortName".replace('-', '')
'secondaryRegionHelloWorldWebAppName'               = "as-$aliasSecondaryRegion-helloworld".replace('-', '')
'secondaryRegionHelloWorldWebAppStorageAccountName' = "sa-$aliasSecondaryRegion-bkphello".replace('-', '')
'sqlToDoAppInsightsName'                            = "appin-$aliasRegion-sqltodo"
'sqlToDoFQDN'                                       = "as-$aliasRegion-sqltodo.azurewebsites.net".replace('-', '')
'sqlToDoHostName'                                   = "sqltodo.$rootDomainName"
'sqlToDoSqlAdminUserName'                           = $resourceUserName
'sqlToDoSqlDatabaseName'                            = "sqldb-$aliasRegion-todo".replace('-', '')
'sqlToDoSqlServerName'                              = "sql-$aliasRegion-todo".replace('-', '')
'sqlToDoWebAppBackupStorageAccountName'             = "sa-$aliasRegion-bkpsqltodo".replace('-', '')
'sqlToDoWebAppName'                                 = "as-$aliasRegion-sqltodo".replace('-', '')
'virtualNetwork03Name'                              = "vnet-$aliasRegion-03"
'virtualNetworkGatewayName'                         = "vng-$aliasRegion-01"
'virtualNetworkGatewayPublicIPAddressName'          = "pip-$aliasRegion-vng01"
'vmssLoadBalancerName'                              = "lb-$aliasRegion-vmss01"
'vmssLoadBalancerPublicIPAddressName'               = "pip-$aliasRegion-lb-vmss01"
'vmssName'                                          = "vmss01"
'vmssNICName'                                       = "nic-$aliasRegion-vmss01"  
'w10clientName'                                     = "vm-w10client01"
'w10clientNICName'                                  = "nic-$aliasRegion-w10client01"
'w10clientOSDiskName'                               = "disk-$aliasRegion-w10client01-os"

'alertsResourceGroupName'                           = "$primaryRegionResourceGroupNamePrefix-alerts"
'bastionResourceGroupName'                          = "$primaryRegionResourceGroupNamePrefix-bastion"
'privateDnsZoneResourceGroupName'                   = "$primaryRegionResourceGroupNamePrefix-privatedns"
'storageResourceGroupName'                          = "$primaryRegionResourceGroupNamePrefix-diagnostics"


### Deploy-AzureDemoEnvironment.ps1

removed
# Deploy-AzureActivityLog $armParameters
# Deploy-AzureVpnGateway $armParameters
# Deploy-AzureFirewall $armParameters
# Deploy-AzureBastion $armParameters
# Deploy-AzurePrivateDns $armParameters
# Deploy-VnetPeering $armParameters
# Deploy-AzureStorageAccountVmDiagnostics $armParameters


### Remove-AzureResourceGroups.ps1

removed
$armParameters.bastionResourceGroupName
$armParameters.privateDnsZoneResourceGroupName
$armParameters.storageResourceGroupName


## deployments

### azure_log_analytics.json

- converted to azure_log_analytics.bicep
- modified function tag to 'monitoring and diagnostics'
- updated workspaces api to 2020-10-01
- added solution for key vault analytics
- removed dataSources child resource for Azure Activity log
  - this is configured via the activity log deployment
- removed azure automation account due to region conflict

### azure_application_insights
- created a dedicated instance of application insights for all app services

### azure_policy.bicep

- converted to policy.bicep

### azure_identity.bicep

- renamed resource group to rg-ade-$aliasPrimaryRegion-identity
- migrated user assigned managed identity creation from Deploy-AzureIdentity.ps1
- creates identities for application gateway and container registry

### azure_key_vault.json

- converted to key_vault.bicep
- modified function tag to 'key vault'
- updated vaults api to 2019-09-01
- TODO: need to consider adding enableRbacAuthorization to the properties and
  enabling rbac authorization

removed azure_key_vault.certificate.sample
removed azure_key_vault.key.sample
removed azure_key_vault.secret.sample

### azure_networking.json

TODO: update this section

- converted to networking.bicep
- removed natGatewayPublicIPAddressName in favor of natGatewayPublicIPPrefixName
- updated publicIPPrefixes api to 2020-06-01
- updated natGateways api to 2020-06-01
- removed virtual network 003
- removed directoryServices subnet
- removed directoryServices network security group
- removed developer subnet
- removed developer network security group

### azure_app_service_plan

- updated deployment that merges both the primary region and secondary region
  deployments
- converted to azure_app_service_plan.bicep
- updated serverFarms api to 2020-10-01
- added an autoscale setting to scale out and in based on cpu utilization to a
  maximum of 10 instances
- updated documentation

### azure_app_service_plan_primary_region

- removed deployment

### azure_app_service_plan_secondary_region

- removed deployment

## modules

### keyvault

#### Deploy-AzureIdentity.ps1

- removed az cli creation of managed identities
- removed az cli commands for key vault access policies

#### Deploy-AzureKeyVault.ps1

- removed New-AzureKeyVaultKey $armParameters.keyVaultName 'containerRegistry'

#### New-AzureKeyVaultKey.ps1

- removed file from repo
