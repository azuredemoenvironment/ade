version: "3.7"

services:
  ade_loadtesting_gatling:
    image: ade_loadtesting_gatling
    container_name: ade_loadtesting_gatling
    build:
      context: ./gatling
      dockerfile: ./Dockerfile
    network_mode: host
    depends_on:
      - ade_loadtesting_grafana
    environment:
      - JAVA_OPTS=-DusersPerSecond=${USERS_PER_SECOND} -DmaxUsersPerSecond=${MAX_USERS_PER_SECOND} -DoverMinutes=${OVER_MINUTES} -Djsse.enableSNIExtension=false
    volumes:
      - ./gatling/conf:/opt/gatling/conf:cached
      - ./gatling/results:/opt/gatling/results
      - ./gatling/simulations:/opt/gatling/user-files/simulations:cached
      - ./gatling/data:/opt/gatling/user-files/data:cached
  ade_loadtesting_redis:
    image: ade_loadtesting_redis
    container_name: redis
    build:
      context: ./redis
      dockerfile: ./Dockerfile
    ports:
      - "6379:6379"
  ade_loadtesting_influxdb:
    image: ade_loadtesting_influxdb
    container_name: influxdb
    build:
      context: ./influxdb
      dockerfile: ./Dockerfile
    ports:
      - "8083:8083"
      - "8086:8086"
      - "2003:2003"
  ade_loadtesting_grafana:
    image: ade_loadtesting_grafana
    container_name: grafana
    build:
      context: ./grafana
      dockerfile: ./Dockerfile
    ports:
      - "3000:3000"
